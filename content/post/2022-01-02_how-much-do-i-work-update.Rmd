---
title: "How much do I work? Updating with 2021"
author: "Samuel C. Zipper"
date: "1/2/2022"
output: 
  html_document:
    toc: true
---
```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
library(patchwork)

## ggplot theme
windowsFonts(Arial=windowsFont("TT Arial"))
theme_scz <- function(...){
  theme_bw(base_size=10, base_family="Arial") + 
    theme(
      text=element_text(color="black"),
      plot.title=element_text(face="bold", size=rel(1)),
      axis.title=element_text(face="bold", size=rel(1)),
      axis.text=element_text(size=rel(1)),
      strip.text=element_text(size=rel(1)),
      legend.title=element_text(face="bold", size=rel(1)),
      legend.text=element_text(size=rel(1)),
      panel.grid=element_blank(),
      plot.margin=unit(c(1,1,1,1), "mm"),
      strip.background=element_blank())
}

theme_set(theme_scz())

# color palette
col.cat.grn <- "#3cb44b"   # green
col.cat.yel <- "#ffe119"   # yellow
col.cat.org <- "#f58231"   # orange
col.cat.red <- "#e6194b"   # red
col.cat.blu <- "#0082c8"   # blue
col.gray <- "gray65"       # gray for annotation lines, etc

# colors by activity
pal_activity <-
  c("research" = "#e41a1c", 
    "logistics" = "#377eb8", 
    "talking" = "#4daf4a", 
"conference" = "#984ea3", 
"service" = "#ff7f00", 
"mentees" = "#ffff33",
"field" = "darkslategray")

# date limits for plots
date_limits <- as.POSIXct(c(ymd("2019-01-01"), ymd("2022-01-02")))

# load 2019 and 2020 data
all_weeks_19 <- read_csv("https://raw.github.com/samzipper/SelfAnalysis/master/WorkTimeAnalysis_Hours_2019.csv", col_types = "ccccT")
all_weeks_20 <- read_csv("https://raw.github.com/samzipper/SelfAnalysis/master/WorkTimeAnalysis_Hours_2020.csv", col_types = "ccccT")
all_weeks_21 <- read_csv("https://raw.github.com/samzipper/SelfAnalysis/master/WorkTimeAnalysis_Hours_2021.csv", col_types = "ccccT")
```

```{r, analysis, include = FALSE}
# combine years
all_weeks <- 
  all_weeks_19 %>% 
  dplyr::bind_rows(all_weeks_20) %>% 
  dplyr::bind_rows(all_weeks_21) %>% 
  subset(!is.na(Time))

# set factors for plotting
all_weeks$Day <- factor(all_weeks$Day, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))
all_weeks$Time <- factor(all_weeks$Time, levels = unique(all_weeks$Time))

# lump 'Travel' with 'Not Work' because I usually sleep on planes, and if I was working on the plane I coded it as such
all_weeks$Activity[all_weeks$Activity == "travel"] <- "Not Work"

# lump 'field' with 'research'
#all_weeks$Activity[all_weeks$Activity == "field"] <- "research"

# data frame with just work hours
all_work <- all_weeks[all_weeks$Activity != "Not Work", ]

# count hours worked
hrs_worked <- sum(all_weeks$Activity != "Not Work")*0.5  # data is at half-hour intervals
n_weeks <- length(unique(all_weeks$week_start_date))

# summarize by week
weekly_hrs <- 
  all_weeks %>% 
  dplyr::group_by(week_start_date) %>% 
  dplyr::summarize(hours_worked = sum(Activity != "Not Work")*0.5) %>% 
  dplyr::mutate(Year = lubridate::year(week_start_date))

# median and mode
getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}
median_hrs_wk <- median(weekly_hrs$hours_worked)
mode_hrs_wk <- getmode(weekly_hrs$hours_worked)

# make a column for the actual date
day_to_number <- tibble(Day = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"),
                        DayNum = seq(0,6))
all_weeks <-  
  dplyr::left_join(all_weeks, day_to_number, by = "Day") %>% 
  dplyr::mutate(date = week_start_date + days(DayNum))

# summarize by day
daily_hrs <- 
  all_weeks %>% 
  dplyr::group_by(date, Day, week_start_date, Daytype) %>% 
  dplyr::summarize(hours_worked = sum(Activity != "Not Work")*0.5) %>% 
  dplyr::mutate(hours_worked_cut = cut(hours_worked, c(0, 0.25, 2, 6, 9, 24), include.lowest = T,
                                       labels = c("0", "0.5 - 2", "2.5 - 6", "6.5 - 9", "> 9.5")),
                Year = lubridate::year(date))

daily_hrs$Day <- factor(daily_hrs$Day, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

# calculate work hours and days
work_hours <- sum(daily_hrs$hours_worked[daily_hrs$Daytype != "conference"])
work_days <- sum(daily_hrs$Daytype == "work") + sum(daily_hrs$Daytype == "half day")*0.5

weekend_hours <- sum(daily_hrs$hours_worked[daily_hrs$Daytype == "weekend"])
weekend_days <- sum(daily_hrs$Daytype == "weekend")
off_days <- sum(daily_hrs$Daytype == "day off")
nowork_days <- sum(daily_hrs$hours_worked == 0)

# to count consecutive days worked/not worked, make a column that is just "0 or not"
daily_hrs$zero <- daily_hrs$hours_worked==0
daily_hrs$zero_counter <- sequence(rle(as.character(daily_hrs$zero))$lengths)

# find max consecutive days worked and not worked
max_days_off <- max(daily_hrs$zero_counter[daily_hrs$zero])
max_days_on <- max(daily_hrs$zero_counter[!daily_hrs$zero])

max_days_off_2021 <- max(subset(daily_hrs, Year == 2021 & zero)$zero_counter)
max_days_on_2021 <- max(subset(daily_hrs, Year == 2021 & !zero)$zero_counter)

max_days_off_not2021 <- max(subset(daily_hrs, Year %in% c(2019, 2020) & zero)$zero_counter)
max_days_on_not2021 <- max(subset(daily_hrs, Year %in% c(2019, 2020) & !zero)$zero_counter)
```

# Last Year
[A year ago, I analyzed my work activities for 2019 and 2020](https://www.samzipper.com/post/2021-01-02_how-much-do-i-work/). The key points were:

> 1. How much do I work?
>   - *Quick answer: ~40-45 hrs/week, and never more than 50 hours (unless I'm away from home for a conference, workshop, or field work). But, I don't take very many days completely off.*
> 2. When I do work, how do I spend my time?
>   - *Quick answer: research has the plurality of my time over the full 2 years, but has been overtaken by logistics (emails and other little tasks) recently.*
> 
> I did this analysis mostly for curiosity's sake, but then realized I should make a couple data-driven resolutions for how to improve my work-life balance in 2021:
> 
>  - Take at least one day per weekend with 0 work hours (preferably both) - I was often spending an hour or two on emails during the weekend.
>  - Reduce the amount of time spent on logistics. I think a recent shift to not checking my email or taking any meetings before 10 AM has been helpful in this regard, but other tips would be welcome.

With another year of data, we see how whether any of those findings have changed, and track whether I've been able to follow my resolutions. 

For those interested, here's the raw data for  [2019](https://docs.google.com/spreadsheets/d/1O4tB-IDLZUqP1I2ECJ9JnBOEDbQEoOwNLbbcBjrV4Tk/edit?usp=sharing),  [2020](https://docs.google.com/spreadsheets/d/1O4tB-IDLZUqP1I2ECJ9JnBOEDbQEoOwNLbbcBjrV4Tk/edit?usp=sharing), and [2021](https://docs.google.com/spreadsheets/d/1cE-u8IsB96H01Y-3G3_JeL8AugWl2oJEPOJDEMtraj0/edit?usp=sharing).


# How much do I work?

My hour count is pretty consistent week-to-week, fluctuating around 40-45 hrs with occasional spikes associated with field work and/or conferences:

```{r, echo=FALSE, fig.width=6, fig.height=4.5} 
ggplot(weekly_hrs, aes(x = week_start_date, y = hours_worked)) +
  geom_col(color = NA, fill = col.cat.blu) +
  scale_x_datetime(name = "Week", expand = c(0, 0), limits = date_limits) +
  scale_y_continuous(name = "Hours Worked in Week") +
  geom_hline(yintercept = 40, color = col.gray)
```

In total, I worked `r sum(subset(weekly_hrs, Year == 2021)$hours_worked)` hours in 2021, compared to `r sum(subset(weekly_hrs, Year == 2020)$hours_worked)` hours in 2020 and `r sum(subset(weekly_hrs, Year == 2019)$hours_worked)` hours in 2019. This translated to a median weekly hour count of `r median(subset(weekly_hrs, Year == 2021)$hours_worked)` hours in 2021, compared to `r median(subset(weekly_hrs, Year == 2020)$hours_worked)` in 2020 and `r median(subset(weekly_hrs, Year == 2019)$hours_worked)` in 2019.

One of my goals was to check my email less on weekends so I would have more days with 0 hours worked. This, overall, was successful: 
```{r, echo=FALSE, fig.width=6, fig.height=8}
ggplot(subset(daily_hrs, Daytype != "conference" & Year != 2022), aes(x = hours_worked, fill = hours_worked_cut)) +
  geom_histogram(binwidth = 0.5) +
  geom_vline(xintercept = 8, color = "black") +
  scale_x_continuous(name = "Daily Hours\nWorked", expand = c(0, 0)) +
  scale_y_continuous(name = "Number of Days") +
  scale_fill_manual(name = "Daily Hours Worked",
                    values = c("gray65", "#ffffb2", "#fecc5c", "#fd8d3c", "#e31a1c")) +
  facet_wrap(~Year, ncol = 1)
```

We can see that, in 2021, there are far more days with 0 hours (`r sum(subset(daily_hrs, Year == 2021)$hours_worked == 0)`days in 2021, compared to `r sum(subset(daily_hrs, Year %in% c(2019, 2020))$hours_worked == 0) in 2019 and 2020 combined`). This is compensated for with fewer days with 0.5 - 1 hours worked. Most of this increase was the result of a deliberate effort to not work on at least one weekend day/week:


```{r, echo=FALSE, fig.width=6, fig.height=8}
ggplot(daily_hrs, aes(x = Day, y = week_start_date, fill = hours_worked_cut)) +
  geom_raster() +
  scale_x_discrete(expand = c(0, 0)) +
  scale_y_datetime(name = "Week", expand = c(0, 0), limits = date_limits) +
  scale_fill_manual(name = "Daily Hours Worked",
                    values = c("gray65", "#ffffb2", "#fecc5c", "#fd8d3c", "#e31a1c")) +
  theme(legend.position = "bottom")
```

This also led to a reduction in the maximum consecutive days I worked (`r max_days_on_2021` days in 2021, down from `r max_days_on_not2021` in the prior two years) and an increase the maximum number of consecutive days off (`r max_days_off_2021` days, up from `r max_days_off_not2021` days in the two years prior).

# What do I do when I'm working?

As a reminder, my six categories of work are: 

 - `talking` = things that involved other people... meetings, seminars, zoom calls, etc.
 - `logistics` = stuff that is generally unimportant (but sometimes necessary). emails, expense reports, etc.
 - `research` = what pays the bills - writing, making presentations, data analysis, reading papers, etc.
 - `conference` = anything at a conference/workshop. I define it broadly so it includes going out for meals with colleagues, etc. - basically, any time I am in the presence of other people.
 - `service` = journal or grant reviews, committees, open science stuff, etc.
 - `mentees` = talking to or working with someone who I am mentoring such as a postdoc or student.

```{r, include=FALSE}
# summarize by activity
work_by_activity <-
  all_work %>% 
  dplyr::group_by(Activity) %>% 
  dplyr::summarize(Hours = n()*0.5,
                   PrcTime = Hours/sum(weekly_hrs$hours_worked)) %>% 
  dplyr::arrange(-Hours)

# yearly percent for each activity
work_by_year <-
  all_work %>% 
  dplyr::mutate(Year = lubridate::year(week_start_date)) %>% 
  dplyr::group_by(Year) %>% 
  dplyr::summarize(halfhrs = n(),
                   conference = sum(Activity=="conference")/halfhrs,
                   logistics = sum(Activity=="logistics")/halfhrs,
                   mentees = sum(Activity=="mentees")/halfhrs,
                   field = sum(Activity=="field")/halfhrs,
                   research = sum(Activity=="research")/halfhrs,
                   service = sum(Activity=="service")/halfhrs,
                   talking = sum(Activity=="talking")/halfhrs) %>% 
  dplyr::select(-halfhrs) %>% 
  tidyr::pivot_longer(all_of(work_by_activity$Activity), names_to = "Activity", values_to = "Time_Prc")

# weekly percent for each activity
work_by_week <-
  all_work %>% 
  dplyr::group_by(week_start_date) %>% 
  dplyr::summarize(halfhrs = n(),
                   conference = sum(Activity=="conference")/halfhrs,
                   logistics = sum(Activity=="logistics")/halfhrs,
                   mentees = sum(Activity=="mentees")/halfhrs,
                   field = sum(Activity=="field")/halfhrs,
                   research = sum(Activity=="research")/halfhrs,
                   service = sum(Activity=="service")/halfhrs,
                   talking = sum(Activity=="talking")/halfhrs) %>% 
  dplyr::select(-halfhrs) %>% 
  tidyr::pivot_longer(all_of(work_by_activity$Activity), names_to = "Activity", values_to = "Time_Prc")

# set factor to order by most to least common
work_by_activity$Activity <- factor(work_by_activity$Activity, levels = work_by_activity$Activity)
all_work$Activity <- factor(all_work$Activity, levels = work_by_activity$Activity)
all_work$Activity <- factor(all_work$Activity, levels = work_by_activity$Activity)
work_by_week$Activity <- factor(work_by_week$Activity, levels = rev(work_by_activity$Activity))
```

Looking at the breakdown of activity for each year:

```{r, echo=FALSE, fig.width=6, fig.height=4.5}
all_work %>% 
  dplyr::mutate(Year = lubridate::year(week_start_date)) %>% 
  ggplot(aes(x = Year, fill = Activity)) +
  geom_bar() +
  scale_y_continuous(name = "Half-Hours") +
  scale_fill_manual(values = pal_activity)
```

There remains a lot of variability from week to week:

```{r, echo=FALSE, fig.width=6, fig.height=4.5}
ggplot(work_by_week, aes(x = week_start_date, y = Time_Prc, fill = Activity)) +
  geom_area(position = "stack") +
  scale_x_datetime(name = "Week", expand = c(0,0), limits = date_limits) +
  scale_y_continuous(name = "Time Spent [%]", expand = c(0,0),
                     labels = scales::percent) +
  scale_fill_manual(values = pal_activity) +
  theme(legend.position = "bottom")
```


```{r, echo=FALSE, fig.width=6, fig.height=4.5}
ggplot(work_by_week, aes(x = week_start_date, y = Time_Prc, color = Activity)) +
  geom_point() +
  scale_x_datetime(name = "Week", expand = c(0,0), limits = date_limits) +
  scale_y_continuous(name = "Time Spent [%]", expand = c(0,0),
                     labels = scales::percent) +
  facet_wrap(~Activity) +
  scale_color_manual(values = pal_activity) +
  stat_smooth(formula = "y ~ x") +
  theme(legend.position = "bottom")
```


# Conclusions



# Some methodological caveats


   
# Bonus: when do I work within the day?
```{r, include=FALSE}
weekday_hours <- 
  all_weeks %>% 
  subset(Daytype == "work") %>% 
  subset(Activity != "Not Work") %>% 
  dplyr::group_by(Time) %>% 
  dplyr::summarize(days_worked = n())

weekend_hours <- 
  all_weeks %>% 
  subset(Daytype %in% c("weekend", "day off")) %>% 
  subset(Activity != "Not Work") %>% 
  dplyr::group_by(Time) %>% 
  dplyr::summarize(days_worked = n())
```
This is the breakdown of when I work (on days categorized as `work` only, not weekends or holidays). This blurs together a few distinct work regimes - as a postdoc I would usually work 7 AM - 3 PM, whereas now I'm more like 8 AM - 4:30 PM with a break during the middle of the day, and an occasional bit of post-dinner email:

```{r, echo=FALSE, fig.width=4, fig.height=6}
ggplot(weekday_hours, aes(x = 1, y = Time, fill = days_worked/sum(daily_hrs$Daytype=="work"))) +
  geom_raster() +
  scale_x_continuous(name = NULL) +
  scale_fill_viridis_c(name = "% of work days I was\nworking at this time",
                       labels = scales::percent, 
                       limits = c(0, 1), breaks = c(0, 0.5, 1)) +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.ticks.x = element_blank()) +
  NULL
```

And, here's when I work on weekends/holidays... Note that the color axis is different, maxing out a bit under 40%. Kids' naptime is quite evident here!
```{r, echo=FALSE, fig.width=4, fig.height=6}
ggplot(weekend_hours, aes(x = 1, y = Time, fill = days_worked/sum(daily_hrs$Daytype %in% c("weekend", "day off")))) +
  geom_raster() +
  scale_x_continuous(name = NULL) +
  scale_fill_viridis_c(name = "% of days off I was\nworking at this time",
                       labels = scales::percent) +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.ticks.x = element_blank()) +
  NULL
```